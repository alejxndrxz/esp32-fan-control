<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control Ventilador ESP32</title>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
        text-align: center;
    }

    .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        width: 330px;
        margin: auto;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    .btn {
        padding: 12px 18px;
        margin: 10px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        color: white;
    }

    .on { background: green; }
    .off { background: red; }
    .mode { background: #3366ff; }
</style>

</head>
<body>

<h2>Panel de Control - ESP32</h2>

<div class="card">
    <h3>Sensores</h3>
    <p><b>Temperatura:</b> <span id="temp">--</span> °C</p>
    <p><b>Humedad:</b> <span id="hum">--</span> %</p>

    <h3>Ventilador</h3>
    <p><b>Estado:</b> <span id="fanState">--</span></p>

    <button id="btnOn" class="btn on">Encender</button>
    <button id="btnOff" class="btn off">Apagar</button>

    <h3>Modo</h3>
    <p><b>Modo actual:</b> <span id="modeTxt">--</span></p>

    <button id="btnAuto" class="btn mode">Modo Automático</button>
    <button id="btnManual" class="btn mode">Modo Manual</button>
</div>

<script>
    // ------------------ Firebase Config ------------------
    var firebaseConfig = {
        apiKey: "TU_API_KEY",
        databaseURL: "TU_DB_URL"
    };
    firebase.initializeApp(firebaseConfig);

    var db = firebase.database();

    // ------------------ Lecturas en tiempo real ------------------

    // Temperatura
    db.ref("latest/temperature").on("value", (s) => {
        document.getElementById("temp").innerText = s.val();
    });

    // Humedad
    db.ref("latest/humidity").on("value", (s) => {
        document.getElementById("hum").innerText = s.val();
    });

    // Estado del ventilador
    db.ref("latest/ventState").on("value", (s) => {
        if (s.val() === true) document.getElementById("fanState").innerText = "ENCENDIDO";
        else document.getElementById("fanState").innerText = "APAGADO";
    });

    // Modo manual/auto
    db.ref("latest/manualMode").on("value", (s) => {
        if (s.val() === true)
            document.getElementById("modeTxt").innerText = "MANUAL";
        else
            document.getElementById("modeTxt").innerText = "AUTOMÁTICO";
    });

    // ------------------ Botones ------------------

    // Encender ventilador (solo manual)
    document.getElementById("btnOn").onclick = () => {
        db.ref("latest/manualMode").set(true);  // forzar manual
        db.ref("latest/ventState").set(true);
    };

    // Apagar ventilador (solo manual)
    document.getElementById("btnOff").onclick = () => {
        db.ref("latest/manualMode").set(true);  // forzar manual
        db.ref("latest/ventState").set(false);
    };

    // Cambiar a automático
    document.getElementById("btnAuto").onclick = () => {
        db.ref("latest/manualMode").set(false);
    };

    // Cambiar a manual
    document.getElementById("btnManual").onclick = () => {
        db.ref("latest/manualMode").set(true);
    };

</script>

</body>
</html>
